var MentionMe=(function($,m){"use strict";function init(){var postIds,mentioned=Cookie.get("multi_mention");if(mentioned){postIds=mentioned.split("|");$(postIds).each(function(){if($("#multi_mention_link_"+this).length){$("#multi_mention_link_"+this).addClass('postbit_multimention_on');}});if($("#quickreply_multi_mention").length){$("#quickreply_multi_mention").show();}}
return true;}
function mention(pid){var $el,newPostIds=new Array(),mentioned=Cookie.get("multi_mention"),isNew=true,postIds;if(mentioned){postIds=mentioned.split("|");$(postIds).each(function(){if(this!=pid&&this!=''){newPostIds[newPostIds.length]=this;}else if(this==pid){isNew=false;}});}
if(isNew==true){newPostIds[newPostIds.length]=pid;}
if($("#multi_mention_link_"+pid).length){$el=$("#multi_mention_link_"+pid);if(isNew==true){$el.removeClass('postbit_multimention');$el.addClass('postbit_multimention_on');}else{$el.removeClass('postbit_multimention_on');$el.addClass('postbit_multimention');}}
if($('#quickreply_multi_mention')){if(newPostIds.length>0){$('#quickreply_multi_mention').show();}else{$('#quickreply_multi_mention').hide();}}
Cookie.set("multi_mention",newPostIds.join("|"));}
function load(){if(use_xmlhttprequest==1){$.ajax({type:'get',url:'xmlhttp.php',data:{action:'mentionme',mode:'get_multi_mentioned',load_all:1,},success:insert,});return false;}
return true;}
function insert(data){var $textarea=$("#message"),message;if(data.match(/<error>(.*)<\/error>/)){message=data.match(/<error>(.*)<\/error>/);if(!message[1]){message[1]="An unknown error occurred.";}
$.jGrowl('There was an error fetching the posts.\n\n'+message[1],{theme:'jgrowl_error'});}else if(data){if($textarea.val()){$textarea.val($textarea.val()+"\n");}
$textarea.val($textarea.val()+data);}
clear();$('#quickreply_multi_mention').hide();$('#mentioned_ids').val('all');$textarea.focus();}
function clear(){var $el,postIds,mentioned=Cookie.get("multi_mention");$('#quickreply_multi_mention').hide();if(mentioned){postIds=mentioned.split("|");$(postIds).each(function(){if($("#multi_mention_link_"+this).length){$el=$("#multi_mention_link_"+this);$el.removeClass('postbit_multimention_on');$el.addClass('postbit_multimention');}});}
Cookie.unset('multi_mention');}
m.multi={init:init,load:load,clear:clear,mention:mention,};$(init);return m;})(jQuery,MentionMe||{});